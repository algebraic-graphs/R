---
title: "Simulating data from dags with ralget"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simulating data from dags with ralget}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
rm(list = ls())
library(tidyverse)
library(tidygraph)
library(ggraph)
library(patchwork)
library(magrittr)
library(ralget)
library(ggforce)
```

### Specify how nodes generate data and evaluate inputs
```{r}
a <- v("a", .func = function(...){rnorm(n = 1000, mean = rsum(...), sd = .5)})
c <- v("c", .func = function(...){rnorm(n = 1000, mean = rsum(...), sd = .5)})
x <- v("x", .func = function(...){rnorm(n = 1000, mean = rsum(...), sd = .5)})
y <- v("y", .func = function(...){rnorm(n = 1000, mean = rsum(...), sd = .5)})
m <- v("m", .func = function(...){rnorm(n = 1000, mean = rsum(...), sd = .5)})
```


### Declare causal connections
```{r echo=TRUE, message=FALSE, warning=FALSE, include = TRUE, fig.height=3, fig.width=7}
g <-
 (a * b(1) + m * b(5)) * x +
 (c * b(2) + m * b(1)) * y +
 (a * b(3) + c * b(4)) * m

 g %>% dag_plot()
```


### Simulate data from DAG
```{r}
g %>% simulate(label = "Obs")
g %>% do_causal(a =  0) %>% simulate("do(a = -1)")
g %>% do_causal(a =  1) %>% simulate("do(a =  1)")
```

### Generate data from DAG
```{r}
obs <- g %>% simulate(label = "Observational")
do0 <- g %>% do_causal(a = -1) %>% simulate(label = "do(a = -1)")
do1 <- g %>% do_causal(a =  1) %>% simulate(label = "do(a =  1)")
```

### Compare intervention distributions
```{r echo=TRUE, message=FALSE, warning=FALSE, include = TRUE, fig.height=5, fig.width=7}
bind_rows(obs, do0, do1) %>% plot_joint_distributions()
```